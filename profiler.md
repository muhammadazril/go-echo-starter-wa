# Profiler

This is some place you want to store your user/client profile, validate it if this is correct clients.

The idea is simple, client push payload to spesified topic in related with spesific process. 

## Client

This is not intended for profiler's client, but for administer service to create a client in profiler. Timestamp is ```ISO8601``` date format. Secret is bcrypt hashed from concated string of ```key + reqid + timestamp```.

Internal key are stored in profiler config.

```
TOPIC : profiler.create.client
{
  "reqid": "f7254292-50f7-44d6-a7b2-1655b8cba475",
  "timestamp": "2020-05-27T21:13:00+07:00",
  "secret": "$2a$12$T1/OwT75QPVDZi3pmM4hkeaiiw5B36rO6PSRMrs4Z//XDl1VcouAS",
  "request": {
    "clientid": "yourclientsclientid",
    "key": "yourapikey"
  }
}
```


## Profile

### Create Profile

- clientid is given is client reg number
- reqid are generated by client in GUID format
- secret is hashed with bcrypt

```
TOPIC : profiler.create.profile.req
{
  "from": {
    "clientid": "2156bfa5-2e2b-4678-957d-d66be5e56dfd",
    "reqid": "f7254292-50f7-44d6-a7b2-1655b8cba475",
    "secret": "1ccd6af4a2ca8d765ba5be68caa7c2dd"
  },
  "request": {
    "identifier": {
      "clientid": "yourclientsclientid",
      "username": "imanalterra",
      "email": "iman@alterra.id",
      "mobileno": "+6281353742201"
    },
    "secrets": {
      "password": "$2a$12$xOYq4S.AAtz7aOJvbL7mQ.OWYDVKUxcU8r.HD5OWR6QmOJ2RLeb8.",
      "apikey": "a87a54a7-f747-48b1-a0ca-671e7bba07ea",
      "accesscode": {
        "code": "xty6746ff",
        "exp_at": 1590586911
      }
    }
    "roles": [
      {
        "name": "superadmin",
        "permission": ["read", "write", "delete"]
      },
      {
        "name": "reader",
        "permission": ["read"]
      },
      {
        "name": "writer",
        "permission": ["read", "write"]
      }
    ],
    "meta": {
      "tz": "+7",
      "key.1": "string",
      "key.2": "2019-02-20 09:09:09",
      "key.3": {
        "other": "metadata"
      }
    }
  }
}
```

```
TOPIC : profiler.create.profile.req
{
  "from": {
    "clientid": "2156bfa5-2e2b-4678-957d-d66be5e56dfd",
    "reqid": "f7254292-50f7-44d6-a7b2-1655b8cba475",
    "secret": "1ccd6af4a2ca8d765ba5be68caa7c2dd"
  },
  "request": {
    "identifier": {
      "clientid": "yourclientsclientid",
      "username": "imanalterra",
      "email": "iman@alterra.id",
      "mobileno": "+6281353742201"
    },
    "secrets": {
      "password": "$2a$12$xOYq4S.AAtz7aOJvbL7mQ.OWYDVKUxcU8r.HD5OWR6QmOJ2RLeb8.",
      "apikey": "a87a54a7-f747-48b1-a0ca-671e7bba07ea",
      "accesscode": {
        "code": "xty6746ff",
        "exp_at": 1590586911
      }
    }
    "roles": [
      {
        "name": "superadmin",
        "permission": ["read", "write", "delete"]
      },
      {
        "name": "reader",
        "permission": ["read"]
      },
      {
        "name": "writer",
        "permission": ["read", "write"]
      }
    ],
    "meta": {
      "tz": "+7",
      "key.1": "string",
      "key.2": "2019-02-20 09:09:09",
      "key.3": {
        "other": "metadata"
      }
    }
  }
}
```

### Get & Validate A Profile

```
TOPIC : profiler.get.profile
{
  
}
```

### Changes Profile

### Remove A Profile


